
.. DO NOT EDIT.
.. THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY.
.. TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
.. "examples\gallery_examples\01-apdlmath-examples\solve_sparse_matrix.py"
.. LINE NUMBERS ARE GIVEN BELOW.

.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        Click :ref:`here <sphx_glr_download_examples_solve_sparse_matrix.py>`
        to download the full example code

.. rst-class:: sphx-glr-example-title

.. _sphx_glr_examples_solve_sparse_matrix.py:


Performing Sparse Factorization and Solve Operations
----------------------------------------------------

Using APDLMath, you can solve linear systems of equations based on
sparse or dense matrices.

.. GENERATED FROM PYTHON SOURCE LINES 9-17

.. code-block:: default

    from ansys.mapdl.core.examples import vmfiles
    import ansys.math.core.math as amath

    # Start Ansys Math
    mm = amath.Math()








.. GENERATED FROM PYTHON SOURCE LINES 18-26

Factorize and Solve Sparse Linear Systems
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
First, run a MAPDL solve to create a .full file
We use a model from the official verification manual.

After a solve command, the full contains the assemblied stiffness
matrix, mass matrix, and the load vector.


.. GENERATED FROM PYTHON SOURCE LINES 26-28

.. code-block:: default

    out = mm._mapdl.input(vmfiles["vm153"])








.. GENERATED FROM PYTHON SOURCE LINES 29-31

List the files in current directory


.. GENERATED FROM PYTHON SOURCE LINES 31-33

.. code-block:: default

    mm._mapdl.list_files()





.. rst-class:: sphx-glr-script-out

 .. code-block:: none


    ['.__tmp__.inp', '.__tmp__.out', 'cleanup-ansys-AAPGBKIlFqYCCBP-18036.bat', 'file.ans_log', 'file.DSP', 'file.esav', 'file.full', 'file.ldhi', 'file.lock', 'file.mlv', 'file.mntr', 'file.mode', 'file.rdb', 'file.rst', 'file.rth', 'file.stat', 'file0.bat', 'file0.DSP', 'file0.emat', 'file0.err', 'file0.esav', 'file0.full', 'file0.full_Glob', 'file0.log', 'file0.mlv', 'file0.mode', 'file0.page', 'file0.r001', 'file0.rsx', 'file0.rth', 'file0.stat', 'file000.jpg', 'file1.DSP', 'file1.emat', 'file1.err', 'file1.esav', 'file1.full', 'file1.full_Glob', 'file1.log', 'file1.mlv', 'file1.mode', 'file1.out', 'file1.page', 'file1.r001', 'file1.rsx', 'file1.rth', 'file1.stat', 'PRSMEMB.DSP', 'PRSMEMB.emat', 'PRSMEMB.esav', 'PRSMEMB.full', 'PRSMEMB.mntr', 'PRSMEMB.mode', 'PRSMEMB.rst', 'PRSMEMB0.emat', 'PRSMEMB0.esav', 'PRSMEMB0.full', 'PRSMEMB0.mode', 'PRSMEMB0.rst', 'PRSMEMB000.jpg', 'PRSMEMB001.jpg', 'PRSMEMB002.jpg', 'PRSMEMB003.jpg', 'PRSMEMB004.jpg', 'PRSMEMB005.jpg', 'PRSMEMB006.jpg', 'PRSMEMB007.jpg', 'PRSMEMB008.jpg', 'PRSMEMB009.jpg', 'PRSMEMB010.jpg', 'PRSMEMB011.jpg', 'PRSMEMB1.emat', 'PRSMEMB1.esav', 'PRSMEMB1.full', 'PRSMEMB1.mode', 'PRSMEMB1.rst', 'SCRATCH', 'SOLVIT.MAC', 'TABLE_1', 'TABLE_2', 'vm1.vrt', 'vm153.vrt', 'vm5.vrt', '_input_tmp_eckzajiycm_.inp', '_input_tmp_eckzajiycm_.out', '_input_tmp_fxjztmnkph_.inp', '_input_tmp_fxjztmnkph_.out', '_input_tmp_gqtihpysna_.inp', '_input_tmp_gqtihpysna_.out', '_input_tmp_hefydogvat_.inp', '_input_tmp_hefydogvat_.out', '_input_tmp_jxvpvdsgnf_.inp', '_input_tmp_jxvpvdsgnf_.out', '_input_tmp_knivllctks_.inp', '_input_tmp_knivllctks_.out', '_input_tmp_lczmpdvuse_.inp', '_input_tmp_lczmpdvuse_.out', '_input_tmp_ljyeusciol_.inp', '_input_tmp_ljyeusciol_.out', '_input_tmp_mphzfrgxwg_.inp', '_input_tmp_mphzfrgxwg_.out', '_input_tmp_muikmyifgz_.inp', '_input_tmp_muikmyifgz_.out', '_input_tmp_nwqmbgeqoa_.inp', '_input_tmp_nwqmbgeqoa_.out', '_input_tmp_ocfdokqbun_.inp', '_input_tmp_ocfdokqbun_.out', '_input_tmp_pwaxobavet_.inp', '_input_tmp_pwaxobavet_.out', '_input_tmp_pxamswrypz_.inp', '_input_tmp_pxamswrypz_.out', '_input_tmp_qoqghpnzcc_.inp', '_input_tmp_qoqghpnzcc_.out', '_input_tmp_rsntkhkfsk_.inp', '_input_tmp_rsntkhkfsk_.out', '_input_tmp_sjdchqcfqt_.inp', '_input_tmp_sjdchqcfqt_.out', '_input_tmp_snvpysxilk_.inp', '_input_tmp_snvpysxilk_.out', '_input_tmp_tqqtbgenrh_.inp', '_input_tmp_tqqtbgenrh_.out', '_input_tmp_vntdumbydu_.inp', '_input_tmp_vntdumbydu_.out', '_input_tmp_wlddqncmej_.inp', '_input_tmp_wlddqncmej_.out', '_input_tmp_wwtqbbbwrc_.inp', '_input_tmp_wwtqbbbwrc_.out', '_input_tmp_wxahydxlbz_.inp', '_input_tmp_wxahydxlbz_.out', '_input_tmp_xcaxlqpqwf_.inp', '_input_tmp_xcaxlqpqwf_.out', '_input_tmp_xsglfgoukr_.inp', '_input_tmp_xsglfgoukr_.out', '_input_tmp_yayvnogvyz_.inp', '_input_tmp_yayvnogvyz_.out', '_input_tmp_yptftrtzse_.inp', '_input_tmp_yptftrtzse_.out', '_tmp.iges']



.. GENERATED FROM PYTHON SOURCE LINES 34-41

Extract the Stiffness matrix from the ``FULL`` file, in a sparse
matrix format.

You can get help on the stiff function with ``help(mm.stiff)``

Printout the dimensions of this Sparse Matrix


.. GENERATED FROM PYTHON SOURCE LINES 41-44

.. code-block:: default

    k = mm.stiff(fname="PRSMEMB.full")
    k





.. rst-class:: sphx-glr-script-out

 .. code-block:: none


    Sparse APDLMath Matrix (126, 126)



.. GENERATED FROM PYTHON SOURCE LINES 45-47

Get a copy of the K Sparse Matrix as a Numpy Array


.. GENERATED FROM PYTHON SOURCE LINES 47-50

.. code-block:: default

    ky = k.asarray()
    ky





.. rst-class:: sphx-glr-script-out

 .. code-block:: none


    <126x126 sparse matrix of type '<class 'numpy.float64'>'
    	with 738 stored elements in Compressed Sparse Row format>



.. GENERATED FROM PYTHON SOURCE LINES 51-55

Extract the load vector from the ``FULL`` file.

Printout the norm of this vector.


.. GENERATED FROM PYTHON SOURCE LINES 55-58

.. code-block:: default

    b = mm.rhs(fname="PRSMEMB.full")
    b.norm()





.. rst-class:: sphx-glr-script-out

 .. code-block:: none


    3.472960080375275e-05



.. GENERATED FROM PYTHON SOURCE LINES 59-61

Get a copy of the load vector as a numpy array


.. GENERATED FROM PYTHON SOURCE LINES 61-63

.. code-block:: default

    by = b.asarray()








.. GENERATED FROM PYTHON SOURCE LINES 64-66

Factorize the Stifness Matrix using the MAPDL DSPARSE solver


.. GENERATED FROM PYTHON SOURCE LINES 66-68

.. code-block:: default

    s = mm.factorize(k)








.. GENERATED FROM PYTHON SOURCE LINES 69-71

Solve the linear system


.. GENERATED FROM PYTHON SOURCE LINES 71-73

.. code-block:: default

    x = s.solve(b)








.. GENERATED FROM PYTHON SOURCE LINES 74-76

Print the **norm** of the solution vector


.. GENERATED FROM PYTHON SOURCE LINES 76-78

.. code-block:: default

    x.norm()





.. rst-class:: sphx-glr-script-out

 .. code-block:: none


    5.815928297029957e-08



.. GENERATED FROM PYTHON SOURCE LINES 79-83

We check the accuracy of the solution, by verifying that

:math:`KX - B = 0`


.. GENERATED FROM PYTHON SOURCE LINES 83-87

.. code-block:: default

    kx = k.dot(x)
    kx -= b
    print("Residual error:", kx.norm() / b.norm())





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    Residual error: 1.8484795505161723e-15




.. GENERATED FROM PYTHON SOURCE LINES 88-90

Summary of all allocated APDLMath Objects


.. GENERATED FROM PYTHON SOURCE LINES 90-92

.. code-block:: default

    mm.status()





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    APDLMATH PARAMETER STATUS-  (      5 PARAMETERS DEFINED)

      Name                   Type            Mem. (MB)       Dims            Workspace

       EZXXKB                SMAT            0.011           [126:126]               1
       BULYXV                VEC             0.001           126             1
       GZKHYP                VEC             0.001           126             1
       JFVUCR                VEC             0.001           126             1
       NBUWCL                LSENGINE        --              --              1




.. GENERATED FROM PYTHON SOURCE LINES 93-95

Delete all APDLMath Objects


.. GENERATED FROM PYTHON SOURCE LINES 95-98

.. code-block:: default

    mm.free()









.. GENERATED FROM PYTHON SOURCE LINES 99-100

Stop mapdl

.. GENERATED FROM PYTHON SOURCE LINES 100-101

.. code-block:: default

    mm._mapdl.exit()








.. rst-class:: sphx-glr-timing

   **Total running time of the script:** ( 0 minutes  2.395 seconds)


.. _sphx_glr_download_examples_solve_sparse_matrix.py:

.. only:: html

  .. container:: sphx-glr-footer sphx-glr-footer-example


    .. container:: sphx-glr-download sphx-glr-download-python

      :download:`Download Python source code: solve_sparse_matrix.py <solve_sparse_matrix.py>`

    .. container:: sphx-glr-download sphx-glr-download-jupyter

      :download:`Download Jupyter notebook: solve_sparse_matrix.ipynb <solve_sparse_matrix.ipynb>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.github.io>`_
